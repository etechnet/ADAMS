<HEAD>
<TITLE>ScriptBasic Developers Manual: 2.1. External Preprocessor</TITLE>

<META NAME="description" CONTENT="ScriptBasic Developers Manual: External Preprocessor">
<META NAME="keywords" CONTENT="ScriptBasic Developers Manual: External Preprocessor">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META NAME="Generator" CONTENT="t2h.pl">

</HEAD>

<BODY LANG="" BGCOLOR="#C7C1A7" TEXT="#000000" LINK="#0000FF" VLINK="#800080" ALINK="#FF0000">
<FONT FACE="Verdana" Size="2">

<UL><a href="devguide_toc.html">[Contents]</A><BR>
<UL><a href="devguide_2.html">2. Interpreter Architecture</A><BR>
</UL>
</UL>
<P>
<H1>2.1. External Preprocessor</H1>
<A HREF="devguide_2.html">[&lt;&lt;&lt;]</A> <A HREF="devguide_2.1.1.html">[&gt;&gt;&gt;]</A>
<UL>
<A HREF="devguide_2.1.1.html">2.1.1. External preprocessor handling</A><BR>
<A HREF="devguide_2.1.2.html">2.1.2. Execute external preprocessors</A><BR>
<HR>
<P>

The module that implements the external preprocessor handling is coded in the C source file `<font size="3"><tt>epreproc.c</tt></font>' (Note that there is a file `<font size="3"><tt>ipreproc.c</tt></font>' that handles internal preprocessors.) The sole function in this file is named <font size="3"><tt>epreproc</tt></font>. This is quite a complex function that gets a lot of arguments listing all the preprocessors that have to be executed one after the other on the source file or on the file created by the previous preprocessor in case there are more than one preprocessors to be applied in chains. The function gets a series of preprocessors to be executed in the command line but in case there is no preprocessor defined in the arguments it executes the preprocessors that have to be executed according to the BASIC program file name extension and the configuration file.
<P>
Only the preprocessors that are configured can be executed. Each preprocessor has a symbolic name, which is used to name it in the configuration file or on the command line using the option `<font size="3"><tt>-p</tt></font>'.
<P>
An external preprocessor is a program that reads a text file and produces a text file. ScriptBasic executes the external preprocessor in a separate process and supplies it with the input and the output file name on the command line. For example the `<font size="3"><tt>scriba.conf.lsp</tt></font>' configuration file may contain the following lines
<P>
<FONT SIZE="3" COLOR="BLUE"><PRE>
preproc (
  extensions (
     heb "heb"
     )
  external (
    heb (
      executable "/usr/bin/scriba /usr/share/scriba/source/heber.bas"
      directory "/var/cache/scriba/hebtemp/"
      )    
    )
  )
</PRE></FONT>
<P>
The key <font size="3"><tt>executable</tt></font> defines the executable image of the preprocessor. In this case this is an executable image and an argument because the HEB (HTML Embedded Basic) preprocessor is written in BASIC. The other arguments, namely the input file name and the output file name are appended after this string separated by space. When the preprocessor is executed the actual command line is
<P>
<FONT SIZE="3" COLOR="BLUE"><PRE>
/usr/bin/scriba /usr/share/scriba/source/heber.bas myprog.heb /var/cache/scriba/hebtemp/ADBKPLNBDELMMNKGNBBLHAHGBKKJFIMN
</PRE></FONT>
<P>
(The above sample command line may be split into two lines by the printing/displaying system, but this is essentially a single command line with the executable name and the two arguments.)
<P>
The final argument is a file name automatically generated by ScriptBasic using MD5 calculation of the input file name full path (may and presumably should not be correct in this example above as I just typed some random 32 characters). The preprocessor should read the file <font size="3"><tt>myprog.heb</tt></font> and should generate <font size="3"><tt>/var/ca@dots{</tt></font>MN} (forgive me for not typing that long file name again).
<P>
If there are more preprocessor to be executed on the generated result then the next is executed on the generated file as input file and another output file is generated.
<P>
The preprocessor program should gracefully exit the process it runs in and exit with the code <font size="3"><tt>0</tt></font>. Any other process exit code is treated as error and the further processing of the BASIC program is aborted.
<P>
The sample code for the HEB preprocessor can be found in the ScriptBasic source distribution. Note that this preprocessor implementation is a sample and is not meant to be a professional, commercial grade preprocessor.<HR>
<A HREF="devguide_2.html">[&lt;&lt;&lt;]</A> <A HREF="devguide_2.1.1.html">[&gt;&gt;&gt;]</A>
</FONT>
</BODY>

</HTML>
